---
date: "2024-08-03T13:47:33+03:00"
description: ""
id: ezb5obwt6oq5e8v7b6ndgyg
publish: true
title: Memory Consistency Models
updated: 1722690142002
---

<https://www.youtube.com/watch?v=H_X8c1M3BZs>

<https://people.mpi-sws.org/~viktor/wmc/>

<https://www.cl.cam.ac.uk/~pes20/weakmemory/cacm.pdf> 

<https://paulcavallaro.com/blog/x86-tso-a-programmers-model-for-x86-multiprocessors/>

<https://go.dev/ref/mem>

<https://research.swtch.com/hwmm>

<https://blog.acolyer.org/2016/02/02/arm-v8/>

- проблемы
  - [Memory Reordering](https://en.wikipedia.org/wiki/Memory_ordering)
  - CPU store buffer ^SB
    - перед взаимодействием с кэшом и [[organize.resource.it.concurrency.cache-coherence|протоколом когерентности]] есть еще Store Buffer, который может быть использован при оптимизации процессорных инструкций.
    - проблема описана в мануалах x86 примерно с таким заголовком - *Loads May Be Reordered with Earlier Stores to Different Locations*

- модели (согласованности) памяти
  - главные вопросы моделей памяти
    - как описать все возможные исполнения многопоточной программы?
    - какую запись увидит чтение?
    - как гарантировать, что чтение увидит нужную запись?
  - кому нужны модели памяти?
    - разработчикам процессоров и разработчикам OS
      - чтобы 
    - языкам программирования и программистам
      - программисты не хотят о конкретных реализациях, поэтому модели памяти дают абстракцию над железом, чтобы писать портируемый код между разными архитектурами.
  - подходы к Моделям памяти
    - Операционый - как программа *исполняется* на процессоре
      - используется для описания моделей памяти процессора, используется разработчиками ядра 
    - Трансформационый - как *меняется* программа при исполнении, какие трансформации она испытывает на себе
      -  так думают люди, но при описании моделей памяти так лучше не делать
    - Декларативный - какие исполнения программы мы *наблюдаем*, какие в них есть порядки
      - используется языками программирования
  - Операционные модели
    - x86 memory models
    - ARMv8 flowing  model
  - Декларативная модель
    - эта модель описывает порядки и отношения
    - linux kernel memory model
      - программа = переменные, обращения к памяти, control flow
      - исполнение программы = граф ( события + частичные порядки )
      - модель памяти = частичные порядки + ограничения
  - SC - sequential consistency
    - DRF-SC - data-race-free sequencial consistency   
    - строгая модель памяти
    - *результат* исполнения многопоточных программ выглядит будто все потоки находятся на одном ядре и операции в них происходят как при некотором последовательном исполнении
    - способы достижения *результата* не должны нас волновать и от них мы абстрагируемся.
  - TSO - total store order - 
    - модель памяти в x86 процессорах
    - существует [[organize.resource.it.os.memory-consistency-models#^SB|Store Buffer]]