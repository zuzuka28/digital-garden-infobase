---
date: "2024-06-26T12:14:52+03:00"
description: ""
id: z6c2c1048giohjmrql1813r
publish: true
title: Network
updated: 1719400628508
---

<https://habr.com/ru/companies/ruvds/articles/759988/> - годно!

## Сетевые модели

OSI - 7 уровней

TCP/IP - 4 уровня

| OSI                   | TCP/IP               |
| --------------------- | -------------------- |
| L7 Application Layer  | L7 Application Layer |
| L6 Presentation Layer | L7 Application Layer |
| L5 Session Layer      | L7 Application Layer |
| L4 Transport Layer    | L4 Transport Layer   |
| L3 Network Layer      | L3 Internet Layer    |
| L2 Data Link Layer    | L2 Link Layer        |
| L1 Physical Layer     | L2 Link Layer        |

Примеры протоколов

| OSI                   | Example                |
| --------------------- | ---------------------- |
| L7 Application Layer  | http, ftp, dns, telnet |
| L6 Presentation Layer | ssl, tls               |
| L5 Session Layer      | pptp                   |
| L4 Transport Layer    | tcp, udp               |
| L3 Network Layer      | ip, arp,               |
| L2 Data Link Layer    | Ethernet               |
| L1 Physical Layer     | Ethernet, Bluetooth    |

## Адресация

Для пересылки данных требуется указать отправителя и получателя, что и называется адресацией.

На разных уровнях сетевой модели используются разные способы идентификации

- L2 MAC-адреса
- L3 IP-адреса
- L4 Порты

## Маршрутизация

Хост - физическое устройство с адресом.

Типы адресов

- индивидуальный адрес (unicast address) - уникальный адрес в подсети
- широковещательный адрес (broadcast address) - общий адрес для всех хостов в подсети
- групповой адрес (multicast address)

Глобальная сеть состоит из множества подсетей

При пересылке между хостами в одной подсети просматривается таблица маршрутизации и трафик направляется на нужное устройство.
Если хост не найден в подсети, то трафик направляется на специальный шлюз, который решит, куда дальше направить трафик.

Шлюз использует **NAT (net address translation)**, поэтому внешний IP для всех устройств в подсети идентичен.

## Пересылка данных

Данные пересылаются отдельными частями, где каждая часть содержит информацию о том, от кого и для кого сообщение, а так же некоторая мета-информация.

Часть пересылаемых данных называется PDU ( protocol data unit ) и состочит из header и payload. На разных уровнях PDU называются по-разному

- L2 - фрейм;
- L3 - пакет (IP, ICMP);
- L4 сегмент или датаграмма (TCP, UDP);
- L7 сообщение (DNS, DHCP).

При пересылке данные оборачиваются в информацию о пересылке как капуста, то есть на каждом уровне добавляется своя информация для идентификации получателя. Капуста растет от L7 к L1.

Что содержат PDU на разных уровнях и в разных протоколах.

- L2 фрейм

  - Dst MAC
  - Src MAC
  - данные
  - чек-сумма

- L3 пакет

  - версия
  - размер сообщения
  - отступ фрагмента
  - флаги
  - ttl
  - протокол
  - чексумма заголовка
  - Dst IP
  - Src IP
  - Опции ( IP пакеты достаточно гибкие, поэтому там можно задать разные )
  - данные

- L4 UPD датаграмма

  - Dst Port
  - Src Port
  - размер сообщения
  - чек-сумма
  - данные

- L4 TCP сегмент
  - Dst Port
  - Src Port
  - номер sequence
  - номер ack
  - отступ фрагмента
  - чексумма
  - окно
  - Опции
  - данные

## Протоколы

### Address Resolution Protocol ARP

Протокол для определения MAC адреса по IP адресу.

Используеися для определения получателя в подсети.

### Dynamic Host Configuration Protocol DHCP

Протокол динамической конфигурации хоста.

Используется для автоматической конфигурации хоста, чтобы не делать этого вручную.

### DNS

Протокол преобразования домена хоста в его IP.

Eсть много видов DNS, которые тожно можно получить

- A (Address) — IP-адрес, закреплённый за доменным именем;
- AAAA (IPv6 Address) — IPv6-адрес, закреплённый за доменным именем;
- CNAME (Canonical Name);
- MX (Mail Exchanger);
- NS (Name Server);
- PTR (Pointer);
- SOA (Start of Authority);
- TXT (Text);
- SRV (Service).

### TCP

Протокол гарантирующий передачу данных и их последовательность.
TCP создает надежное полнодуплексное соединение.

Для каждого сообщения присваивается Sequence number и Acknowledge number благодаря которым можно отслеживать пересылку.

При потере данных данные отслеживаются по sequence и отправляются повторно.

Для управления TCP-соединением используются флаги в отсылаемых TCP-сегментах. Наиболее важными являются:

- `SYN` — используется при установлении TCP-соединения;
- `ACK` — означает, что сегмент был получен принимающей стороной;
- `FIN` — используется при нормальном (graceful) закрытии TCP-соединении;
- `RST` — используется при аварийном закрытии TCP-соединения.

Пример обмена данными по TCP:

1. Client SYN -> Server
2. Client <- SYN, ACK Server
3. Client ACK -> Server
4. Передача данных
5. Client FIN, ACK -> Server
6. Client <- ACK Server
7. Client <- FIN, ACK Server
8. Client ACK -> Server

То есть сначала происходит 3 фазный handshake и открытие коннекта, потом передача, а потом 4 фазный handshake и закрытие коннекта.

### UDP

Быстрый протокол передачи данных, допускается дублирование или пропуск данных, не важен порядок доставки.C
